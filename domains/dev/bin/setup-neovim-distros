#!/usr/bin/env bash
set -e

# -----------------------------------------------------------------------------
# Neovim Distro Setup
# Neovimディストリビューションのセットアップ
# -----------------------------------------------------------------------------

# Load utilities
if [[ -n "${DOTFILES_ROOT:-}" ]]; then
    source "$DOTFILES_ROOT/core/utils/common.sh"
elif [[ -f "$HOME/dotfiles/core/utils/common.sh" ]]; then
    source "$HOME/dotfiles/core/utils/common.sh"
fi

# Determine the directory of this script
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
# Go up to domains/dev/config
TARGET_BASE_DIR="$(dirname "$SCRIPT_DIR")/config"

# Helper: Clone if not exists
setup_distro() {
    local name="$1"
    local repo="$2"
    local target="$TARGET_BASE_DIR/nvim-$name"

    log_info "Setup $name..."
    if [[ -d "$target" ]]; then
        log_success "$target already exists"
    else
        log_info "Cloning $name from $repo to $target..."
        git clone "$repo" "$target"
        rm -rf "$target/.git"
        log_success "Installed $name (and removed .git)"
    fi
}

# 1. LazyVim
setup_distro "lazyvim" "https://github.com/LazyVim/starter"

# 2. NvChad
setup_distro "nvchad" "https://github.com/NvChad/NvChad"

# 3. AstroVim
setup_distro "astrovim" "https://github.com/AstroNvim/AstroNvim"

echo ""
log_success "All distributions setup!"
log_info "Use 'nvim-switch <distro>' to switch."
