# tmux configuration

# -- general -------------------------------------------------------------------
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"
set -g history-limit 50000
set -g buffer-limit 20
set -g display-time 1500
set -g remain-on-exit off
set -g repeat-time 300
setw -g allow-rename off
setw -g automatic-rename off
setw -g aggressive-resize on

# -- mouse support -------------------------------------------------------------
set -g mouse on

# -- shell --------------------------------------------------------------------
set-option -g default-shell /opt/homebrew/bin/zsh
set-option -g default-command /opt/homebrew/bin/zsh
if-shell 'test ! -x /opt/homebrew/bin/zsh' 'set-option -g default-shell /bin/zsh'

# -- prefix -------------------------------------------------------------------
unbind C-b
set -g prefix C-q
bind C-q send-prefix

# -- display -------------------------------------------------------------------
set -g base-index 1
setw -g pane-base-index 1
setw -g automatic-rename on
set -g renumber-windows on
set -g set-titles on
set -g display-panes-time 800
set -g display-time 1000
set -g status-interval 10

# -- navigation ---------------------------------------------------------------
# create session
bind C-c new-session

# window navigation (Ctrl+h/l without prefix, like WezTerm)
unbind n
unbind p
bind -n C-h previous-window
bind -n C-l next-window
bind Tab last-window

# split panes (| horizontal, - vertical, like WezTerm)
bind \\ split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# pane navigation (prefix + h/j/k/l)
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# pane zoom (prefix + z, like WezTerm)
bind z resize-pane -Z

# pane close (prefix + x, like WezTerm)
bind x kill-pane

# pane resizing
bind -r H resize-pane -L 2
bind -r J resize-pane -D 2
bind -r K resize-pane -U 2
bind -r L resize-pane -R 2

# scroll mode (prefix + [ for copy-mode with scroll)
bind [ copy-mode

# -- help popup ---------------------------------------------------------------
# Prefix + ? to show keybindings help popup
bind ? display-popup -E -w 50 -h 22 "~/.config/tmux/scripts/keybinds.sh help | less -R"

# Click on status-right to show help popup
bind -n MouseDown1StatusRight display-popup -E -w 50 -h 22 "~/.config/tmux/scripts/keybinds.sh help | less -R"

# -- copy mode ----------------------------------------------------------------
setw -g mode-keys vi
bind Enter copy-mode
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-pipe-and-cancel "pbcopy"
bind -T copy-mode-vi Escape send -X cancel
bind -T copy-mode-vi H send -X start-of-line
bind -T copy-mode-vi L send -X end-of-line

# -- spotify controls ----------------------------------------------------------
bind s run-shell "~/.config/tmux/scripts/spotify.sh toggle"
bind n run-shell "~/.config/tmux/scripts/spotify.sh next"
bind N run-shell "~/.config/tmux/scripts/spotify.sh prev"

# Key bindings for Spotify controls
bind P run-shell '~/.config/tmux/scripts/spotify.sh prev'
bind p run-shell '~/.config/tmux/scripts/spotify.sh toggle'
bind ] run-shell '~/.config/tmux/scripts/spotify.sh next'

# -- plugins -----------------------------------------------------------------
# Set TPM plugin manager path
# TPM„Éó„É©„Ç∞„Ç§„É≥„Éû„Éç„Éº„Ç∏„É£„Éº„ÅÆ„Éë„Çπ„ÇíË®≠ÂÆö
set-environment -g TMUX_PLUGIN_MANAGER_PATH '~/.tmux/plugins'

set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-battery'
set -g @plugin 'tmux-plugins/tmux-cpu'
set -g @plugin 'xamut/tmux-weather'
set -g @plugin 'tmux-plugins/tmux-net-speed'
set -g @plugin 'catppuccin/tmux#v2.1.0' # Use specific version

# Session restore plugins
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

# -- tmux-resurrect configuration --------------------------------------------
# Restore vim/nvim sessions
set -g @resurrect-strategy-vim 'session'
set -g @resurrect-strategy-nvim 'session'

# Restore pane contents
set -g @resurrect-capture-pane-contents 'on'

# Restore additional programs
set -g @resurrect-processes 'ssh vim nvim emacs man less more tail top htop node python go cargo'

# -- tmux-continuum configuration --------------------------------------------
# Auto-restore tmux sessions on startup
set -g @continuum-restore 'on'

# Auto-save interval (minutes)
set -g @continuum-save-interval '15'

# Show restore status in status-right (optional)
# set -g @continuum-status-interval '60'

# -- theme -------------------------------------------------------------------
# Load theme from external file (switched by theme-switch command)
source-file -q ~/.config/tmux/themes/current.conf

# Catppuccin plugin fallback
set -g @catppuccin_flavour 'mocha'

# Unix Porn Status Bar
set -g @catppuccin_window_left_separator "ÓÇ∂"
set -g @catppuccin_window_right_separator "ÓÇ¥ "
set -g @catppuccin_window_middle_separator " ‚ñà"
set -g @catppuccin_window_number_position "right"

set -g @catppuccin_window_default_fill "number"
set -g @catppuccin_window_default_text "#W"

set -g @catppuccin_window_current_fill "number"
set -g @catppuccin_window_current_text "#W"

# WezTerm-inspired status bar configuration
# WezTermÈ¢®„ÅÆÊ¥óÁ∑¥„Åï„Çå„Åü„Çπ„ÉÜ„Éº„Çø„Çπ„Éê„ÉºË®≠ÂÆö

# Status bar positioning and basic settings
set -g status-position bottom
set -g status-justify left
set -g status-left-length 150
set -g status-right-length 300
set -g status-interval 2

# Pill-style status bar with round separators
set -g status-left "#[fg=#cba6f7,bg=#181825]#[fg=#11111b,bg=#cba6f7,bold] üëª #S #[fg=#cba6f7,bg=#181825] "
# Full status bar - info icon (click for help), weather, network, etc.
set -g status-right "#[fg=#fab387]#(~/.config/tmux/scripts/spotify.sh) #[fg=#313244]‚ñè#[fg=#89dceb]#(~/.config/tmux/scripts/keybinds.sh icon) #[fg=#313244]‚ñè#[fg=#89b4fa]#(~/.config/tmux/scripts/weather.sh full) #[fg=#313244]‚ñè#[fg=#f9e2af]#(~/.config/tmux/scripts/weather.sh pressure_full) #[fg=#313244]‚ñè#[fg=#89dceb]‚òî#(~/.config/tmux/scripts/weather.sh rain) #[fg=#313244]‚ñè#[fg=#94e2d5]#(~/.config/tmux/scripts/network.sh) #[fg=#313244]‚ñè#[fg=#f38ba8]#(~/.config/tmux/scripts/earthquake.sh) #[fg=#313244]‚ñè#[fg=#a6e3a1]#{battery_percentage} #[fg=#313244]‚ñè#[fg=#f9e2af]üíª#{cpu_percentage} #[fg=#313244]‚ñè#[fg=#cba6f7,bold]%H:%M#[default]"

# Alternative responsive status bars (uncomment to use instead of full)
# Large screens (>120 chars): Full display
# set -g status-right "#{?#{>:#{window_width},120},#[fg=#fab387]#(~/.config/tmux/scripts/spotify.sh) #[fg=#313244]‚ñè#[fg=#6c7086\\,dim]#(~/.config/tmux/scripts/keybinds.sh all) #[fg=#313244]‚ñè#[fg=#89b4fa]#(~/.config/tmux/scripts/weather.sh full) #[fg=#313244]‚ñè#[fg=#f9e2af]#(~/.config/tmux/scripts/weather.sh pressure_full) #[fg=#313244]‚ñè#[fg=#89dceb]‚òî#(~/.config/tmux/scripts/weather.sh rain) #[fg=#313244]‚ñè#[fg=#94e2d5]#(~/.config/tmux/scripts/network.sh) #[fg=#313244]‚ñè#[fg=#f38ba8]#(~/.config/tmux/scripts/earthquake.sh) #[fg=#313244]‚ñè#[fg=#a6e3a1]#{battery_percentage} #[fg=#313244]‚ñè#[fg=#f9e2af]üíª#{cpu_percentage} #[fg=#313244]‚ñè,#{?#{>:#{window_width},80},#[fg=#89b4fa]#(~/.config/tmux/scripts/weather.sh full) #[fg=#313244]‚ñè#[fg=#a6e3a1]#{battery_percentage} #[fg=#313244]‚ñè,#{?#{>:#{window_width},40},#[fg=#a6e3a1]#{battery_percentage} #[fg=#313244]‚ñè,}}}#[fg=#cba6f7\\,bold]%H:%M#[default]"

# Medium screens (80-120 chars): Weather, battery, time only
# set -g status-right "#[fg=#89b4fa]#(~/.config/tmux/scripts/weather.sh full) #[fg=#313244]‚ñè#[fg=#a6e3a1]#{battery_percentage} #[fg=#313244]‚ñè#[fg=#cba6f7,bold]%H:%M#[default]"

# Small screens (<40 chars): Time only
# set -g status-right "#[fg=#cba6f7,bold]%H:%M#[default]"

# Remove default catppuccin status modules to use custom ones
set -g @catppuccin_status_modules_right ""
set -g @catppuccin_status_left_separator  " ÓÇ∂"
set -g @catppuccin_status_right_separator "ÓÇ¥"
set -g @catppuccin_status_right_separator_inverse "no"
set -g @catppuccin_status_fill "icon"
set -g @catppuccin_status_connect_separator "no"

# Status bar styling and colors
# „Çπ„ÉÜ„Éº„Çø„Çπ„Éê„Éº„ÅÆ„Çπ„Çø„Ç§„É™„É≥„Ç∞„Å®Ëâ≤Ë®≠ÂÆö
set -g status-style "bg=#181825,fg=#cdd6f4"

# Pill-style window tabs
set -g window-status-format "#[fg=#313244,bg=#181825]#[fg=#6c7086,bg=#313244] #I #W #[fg=#313244,bg=#181825]"
set -g window-status-current-format "#[fg=#89b4fa,bg=#181825]#[fg=#11111b,bg=#89b4fa,bold] #I #W #[fg=#89b4fa,bg=#181825]"
set -g window-status-separator " "
set -g window-status-activity-style "fg=#f38ba8,bg=#313244"
set -g window-status-bell-style "fg=#fab387,bg=#313244"


# Pane border colors
set -g pane-border-style "fg=#313244"
set -g pane-active-border-style "fg=#cba6f7"

# Message styling
set -g message-style "bg=#cba6f7,fg=#11111b"
set -g message-command-style "bg=#f38ba8,fg=#11111b"

# Initialize TMUX plugin manager
run '~/.tmux/plugins/tpm/tpm'
