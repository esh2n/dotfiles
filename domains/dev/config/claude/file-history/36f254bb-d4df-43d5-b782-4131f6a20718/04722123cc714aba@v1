"use client";

import { Text, Tooltip } from "@sansaninc/one-ui";
import { InfoIcon } from "../../../../../components/ui/icons/Icons";
import { PageTitle } from "../../../../../components/ui/page-title/PageTitle";
import { Title } from "../../../../../components/ui/title/Title";
import { formatDateTime } from "../../../../../lib/format";
import { DatabaseTypeLabel } from "../../(database)/types";
import styles from "./SummaryCard.module.css";
import type { DataSummaryStatistics } from "./types";

type Props = DataSummaryStatistics;

export const SummaryCard = ({
  entityType,
  totalCount,
  importedDataCount,
  whitespaceCount,
  updatedAt,
}: Props) => {
  const entityLabel = DatabaseTypeLabel[entityType];

  return (
    <div className={styles.container}>
      <PageTitle
        title={`${entityLabel}データサマリー`}
        description={`更新日時：${formatDateTime(new Date(updatedAt))}`}
      />
      <div className={styles.card}>
        <div className={styles.progressBarContainer}>
          {importedDataCount > 0 && (
            <div
              className={styles.importedDataBar}
              style={{ flexGrow: importedDataCount } as React.CSSProperties}
            />
          )}
          {whitespaceCount > 0 && (
            <div
              className={styles.whitespaceBar}
              style={{ flexGrow: whitespaceCount } as React.CSSProperties}
            />
          )}
        </div>
        <div className={styles.dataItemStack}>
          <ImportedDataItem
            label={`取り込みデータ（ユニーク${entityLabel}）`}
            value={importedDataCount}
            tooltipText={`取り込んだ${entityLabel}データに SOC を付与し、ユニークとして判定された${entityLabel}データ。`}
            color="imported"
          />
          <WhitespaceItem
            label="ホワイトスペース"
            value={whitespaceCount}
            tooltipText={`${entityLabel}データの中で、取り込みデータ（ユニーク${entityLabel}）を除いたデータ。`}
            color="whitespace"
          />
          <div className={styles.divider} />
          <TotalItem label="合計" value={totalCount} />
        </div>
      </div>
    </div>
  );
};

type DataItemProps = {
  label: string;
  value: number;
  tooltipText: string;
  color: "imported" | "whitespace";
};

const ImportedDataItem = ({
  label,
  value,
  tooltipText,
  color,
}: DataItemProps) => (
  <div className={styles.dataItem}>
    <div className={styles.importedDataItemLabel}>
      <div className={styles.colorIndicator} data-color={color} />
      <Title size="large">{label}</Title>
      <Tooltip
        trigger={<InfoIcon className={styles.infoIcon} />}
        content={<Text>{tooltipText}</Text>}
        placement="top-start"
      />
    </div>
    <Title size="huge">{value.toLocaleString()}件</Title>
  </div>
);

const WhitespaceItem = ({
  label,
  value,
  tooltipText,
  color,
}: DataItemProps) => (
  <div className={styles.dataItem}>
    <div className={styles.whitespaceItemLabel}>
      <div className={styles.colorIndicator} data-color={color} />
      <Title size="medium">{label}</Title>
      <Tooltip
        trigger={<InfoIcon className={styles.infoIcon} />}
        content={<Text>{tooltipText}</Text>}
        placement="top-start"
      />
    </div>
    <Title size="large">{value.toLocaleString()}件</Title>
  </div>
);

const TotalItem = ({ label, value }: { label: string; value: number }) => (
  <div className={styles.dataItem}>
    <div className={styles.totalItemLabel}>
      <Title size="large">{label}</Title>
    </div>
    <Title size="large">{value.toLocaleString()}件</Title>
  </div>
);
